<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title></title>
    <meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <!--标准mui.css-->
    <link rel="stylesheet" href="css/mui.min.css?y=ccc">
    <link href="css/mui.picker.css" rel="stylesheet" />
    <link href="css/mui.poppicker.css" rel="stylesheet" />
    <link rel="stylesheet" href="css/jsdApply.css?y=sss" />
    <script type="text/javascript" src="js/jquery-1.9.1.min.js"></script>
    <script type="text/javascript" src="js/jsdApply.js"></script>
</head>

<body>
    <!--完善借款信息弹窗-->
    <div class="jsdpiPop" style="display: none;">
        <div class="jsdpiPopconB" style="display: block;">
            <p class="pA" style="display: none;"><i></i>您的申请已提交<br/>稍后专业客服将与您联系</p>
            <p class="pB"></p>
            <div class="popBtn">
                <a href="javascript:void(0)">确定</a>
            </div>
        </div>
    </div>
    <header class="mui-bar mui-bar-nav headTitle">
        <h1 class="mui-title">完善借款信息</h1>
    </header>
    <div class="mui-content PerfectInfo">
        <ul class="mui-table-view">
            <li class="mui-table-view-cell">
                <a>
                    <span>姓名</span><input type="text" placeholder="请输入真实姓名" id="name" />
                </a>
            </li>
            <li class="mui-table-view-cell">
                <a>
                    <span>身份证</span><input type="text" placeholder="请输入身份证号" id="idcard" />
                </a>
            </li>
            <li class="mui-table-view-cell">
                <a id="chooseEducation">
                    <span>芝麻信用分</span><input type="text" placeholder="请输入支付宝芝麻信用分" id="education" />
                </a>
            </li>
            <li class="mui-table-view-cell">
                <a class="mui-navigate-right" id="chooseLoan_amount">
                    <span>申请额度</span>
                    <div id="loan_amount" class="choose">1000元</div>
                </a>
            </li>
            <li class="mui-table-view-cell">
                <a id="chooseOccupation">
                    <span>常用QQ号</span><input type="text" placeholder="请输入常用QQ号" id="occupation" />
                </a>
            </li>
            <li class="mui-table-view-cell">
                <a class="mui-navigate-right" id="chooseWhether_borrowing_records">
                    <span>是否有借款记录</span>
                    <div id="whether_borrowing_records" data-id="0" class="choose">无</div>
                </a>
            </li>
            <li class="mui-table-view-cell activeA" style="display: none;">
                <a>
                    <span>借款平台名称</span><input type="text" placeholder="请输入借款平台名称" id="borrowing_platform" />
                </a>
            </li>
            <li class="mui-table-view-cell activeA" style="display: none;">
                <a>
                    <span>负债额度（元）</span><input type="text" placeholder="请输入负债额度" id="liability_limit" />
                </a>
            </li>
        </ul>
        <a class="mui-btn mui-btn-primary mui-btn-block" href="javascript:void(0)" id="btnPerfectInformation">提交审核</a>
    </div>
</body>
<script src="js/mui.min.js"></script>
<script src="js/mui.picker.js"></script>
<script src="js/mui.poppicker.js"></script>
<script>
    mui.init();
    //申请借款枚举
    var loan_amount_enums = [
        '1000元',
        '2000元',
        '3000元'
    ];
    //是否借款记录枚举
    var whether_borrowing_records_enums = [{
        "id": "0",
        "text": "无"
    }, {
        "id": "1",
        "text": "有"
    }];
    mui.ready(function() {
        //申请额度
        mui("body").on("tap", "#chooseLoan_amount", function() {
            var popPicker = new mui.PopPicker();
            popPicker.setData(loan_amount_enums);
            popPicker.show(function(item) {
                $('#loan_amount').html(item[0]);
            });
        });
        //借款记录
        mui("body").on("tap", "#chooseWhether_borrowing_records", function() {
            var popPicker = new mui.PopPicker();
            popPicker.setData(whether_borrowing_records_enums);
            popPicker.show(function(item) {
                $('#whether_borrowing_records').html(item[0]['text']);
                $('#whether_borrowing_records').attr('data-id', item[0]['id']);
                if (item[0]['id'] == 1) {
                    $('.activeA').show();
                } else {
                    $('.activeA').hide();
                }
            });
        });
    });
    mui('.mui-scroll-wrapper').scroll({
        deceleration: 0.0005, //flick 减速系数，系数越大，滚动速度越慢，滚动距离越小，默认值0.0006
        indicators: false
    });

    function IsDefine(value) {
        if (value == null || value == "" || value == "undefined" || value == undefined || value == "null" || value == "(null)" || value == 'NULL' || typeof(value) == 'undefined') {
            return false;
        } else {
            value = value + "";
            value = value.replace(/\s/g, "");
            if (value == "") {
                return false;
            }
            return true;
        }
    }

    function QueryString(val) {
        var uri = window.location.search;
        var re = new RegExp("" + val + "=([^&?]*)", "ig");
        return ((uri.match(re)) ? (uri.match(re)[0].substr(val.length + 1)) : null);
    }

    function IsMobile(value) {
        var myreg = /^(((13[0-9]{1})|(15[0-9]{1})|(17[0-9]{1})|(18[0-9]{1}))+\d{8})$/;
        if (!myreg.test(value)) {
            return false;
        }
        return true;
    }
	function IDCardCheck(num) {
	    num = num.toUpperCase();
	    // 身份证号码为18位，18位前17位为数字，最后一位是校验位，可能为数字或字符X。
	    var len, re;
	    len = num.length;
	  	if(len<18||len>18){
	  		return false;
	  	}
	    if (len == 18) {
	        re = new RegExp(/^(\d{6})(\d{4})(\d{2})(\d{2})(\d{3})([0-9]|X|x)$/);
	        var arrSplit = num.match(re);
	 
	        // 检查生日日期是否正确
	        var dtmBirth = new Date(arrSplit[2] + "/" + arrSplit[3] + "/" + arrSplit[4]);
	        
	        var bGoodDay;
	        bGoodDay = (dtmBirth.getFullYear() == Number(arrSplit[2])) && ((dtmBirth.getMonth() + 1) == Number(arrSplit[3])) && (dtmBirth.getDate() == Number(arrSplit[4]));
	        if (!bGoodDay) {
	            return false;
	        }
	        else {
	            // 检验18位身份证的校验码是否正确。
	            var valnum;
	            var arrInt = new Array(7, 9, 10, 5, 8, 4, 2, 1, 6, 3, 7, 9, 10, 5, 8, 4, 2);
	            var arrCh = new Array('1', '0', 'X', '9', '8', '7', '6', '5', '4', '3', '2');
	            var nTemp = 0, i;
	            for (i = 0; i < 17; i++) {
	                nTemp += num.substr(i, 1) * arrInt[i];
	            }
	            valnum = arrCh[nTemp % 11];
	            if (valnum != num.substr(17, 1)) {
	                return false;
	            }
	            return true;
	        }
	    }
	    return false;
	}
	function  credit(value){
		var myreg = /^[1-9]\d*$/;
        if (myreg.test(value)&&parseFloat(value)>=0&&parseFloat(value)<=950) {
            return true;
        }
        return false;
	}
	function  qq(value){
		var myreg = /^[1-9]\d{4,14}$/;
        if (myreg.test(value)) {
            return true;
        }
        return false;
	}
    var phone_no = QueryString("phone_no");

    if (IsDefine(phone_no) == false || IsMobile(phone_no) == false) {
        window.location = "jsdApply.html";
    }
    //渠道id  默认为1
    var channel_id = "1";
    var channel_id = QueryString("channel_id");
    if (IsDefine(channel_id) == false) {
        channel_id = "1";
    }
    //完善资料点击
    $("#btnPerfectInformation").bind("click", function() {
        var name = $("#name").val();
        var idcard = $("#idcard").val();
        var education = $("#education").val();
        var loan_amount = $("#loan_amount").html().replace('元', '');
        var occupation = $("#occupation").val();
        var whether_borrowing_records = $("#whether_borrowing_records").attr('data-id');
        var borrowing_platform = $("#borrowing_platform").val();
        var liability_limit = $("#liability_limit").val();
        if (IsDefine(name) == false) {
            $('.jsdpiPop').show();
            $('.jsdpiPop .pB').html('请输入姓名');
            return false;
        }
        if (IDCardCheck(idcard) == false) {
            $('.jsdpiPop').show();
            $('.jsdpiPop .pB').html('请输入正确的身份证号');
            return false;
        }
        if (credit(education) == false) {
            $('.jsdpiPop').show();
            $('.jsdpiPop .pB').html('支付宝芝麻信用分仅限0-950数字');
            return false;
        }
        if (qq(occupation) == false) {
            $('.jsdpiPop').show();
            $('.jsdpiPop .pB').html('请输入正确格式的QQ号');
            return false;
        }
        if (whether_borrowing_records == "1") {
            if (IsDefine(borrowing_platform) == false) {
                $('.jsdpiPop').show();
                $('.jsdpiPop .pB').html('请输入借款平台');
                return false;
            }
            if (IsDefine(liability_limit) == false) {
                $('.jsdpiPop').show();
                $('.jsdpiPop .pB').html('请输入负债额度');
                return false;
            } else {
                if (parseFloat(liability_limit) < 1) {
                    $('.jsdpiPop').show();
                    $('.jsdpiPop .pB').html('负债额度必须大于0');
                    return false;
                }
            }
        } else {
            borrowing_platform = "无";
            liability_limit = "0.00";
        }
        var is_test = QueryString("is_test");
        //var submit_url = "http://docking.y4qq.com/advertise/channel?channel_id=1&advertise_id=4&name=" + name + "&phone_no=" + phone_no + "&idcard=" + idcard + "&loan_amount=" + loan_amount + "&education=" + education + "&occupation=" + occupation + "&whether_borrowing_records=" + whether_borrowing_records + "&borrowing_platform=" + borrowing_platform + "&liability_limit=" + liability_limit + "&jsonp_cb_fun=perfectInformationCBFun";

        var submit_url = "http://adv.qingdianwan.com/advertise/channel?channel_id=" + channel_id + "&advertise_id=5&name=" + name + "&phone_no=" + phone_no + "&idcard=" + idcard + "&loan_amount=" + loan_amount + "&zhima_credit=" + education + "&qq=" + occupation + "&whether_borrowing_records=" + whether_borrowing_records + "&borrowing_platform=" + borrowing_platform + "&liability_limit=" + liability_limit + "&jsonp_cb_fun=perfectInformationCBFun";
        $.ajax(submit_url, {
            "method": "GET",
            "dataType": "jsonp",
            "success": "perfectInformationCBFun"
        });
    });

    //完善资料回调
    function perfectInformationCBFun(data) {
        if (data['code'] == 10000) {
            $('.jsdpiPop').show();
            $('.jsdpiPop .pA').show();
            $('.jsdpiPop .pB').hide();
            $('.jsdpiPop .popBtn').click(function() {
                window.location = "jsdApply.html";
            });
        } else {
            $('.jsdpiPop').show();
            $('.jsdpiPop .pA').hide();
            $('.jsdpiPop .pB').html(data['message']);
        }
    }
    $('.jsdpiPop .popBtn').click(function() {
        $(this).parent().parent().hide();
    });
</script>

</html>