<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<style>
			html,
			body {
				width: 100%;
				height: 100%;
				margin: 0;
				padding: 0;
				overflow: hidden;
				background-color: #101010;
			}
			.container {
				position: absolute;
				width: 1000px;
				height: 500px;
				top: 50%;
				left: 50%;
				margin-top: -250px;
				margin-left: -500px;
			}
			canvas {
				position: absolute;
				top: 0;
				left: 0;
			}
		</style>
	</head>

	<body>
		<div id="jsi-fireworks-container" class="container"></div>
	</body>
	<script src="js/jquery-1.9.1.min.js"></script>
	<script>
		var RENDERER={LEAF_INTERVAL_RANGE:{min:100,max:200},FIREWORK_INTERVAL_RANGE:{min:20,max:200},SKY_COLOR:"hsla(210, 60%, %luminance%, 0.2)",STAR_COUNT:100,init:function(){this.setParameters();this.reconstructMethod();this.createTwigs();this.createStars();this.render()},setParameters:function(){this.$container=$("#jsi-fireworks-container");this.width=this.$container.width();this.height=this.$container.height();this.distance=Math.sqrt(Math.pow(this.width/2,2)+Math.pow(this.height/2,2));this.contextFireworks=$("<canvas />").attr({width:this.width,height:this.height}).appendTo(this.$container).get(0).getContext("2d");this.contextTwigs=$("<canvas />").attr({width:this.width,height:this.height}).appendTo(this.$container).get(0).getContext("2d");this.twigs=[];this.leaves=[new LEAF(this.width,this.height,this)];this.stars=[];this.fireworks=[new FIREWORK(this.width,this.height,this)];this.leafInterval=this.getRandomValue(this.LEAF_INTERVAL_RANGE)|0;this.maxFireworkInterval=this.getRandomValue(this.FIREWORK_INTERVAL_RANGE)|0;this.fireworkInterval=this.maxFireworkInterval},reconstructMethod:function(){this.render=this.render.bind(this)},getRandomValue:function(a){return a.min+(a.max-a.min)*Math.random()},createTwigs:function(){this.twigs.push(new TWIG(this.width,this.height,0,0,Math.PI*3/4,0));this.twigs.push(new TWIG(this.width,this.height,this.width,0,-Math.PI*3/4,Math.PI));this.twigs.push(new TWIG(this.width,this.height,0,this.height,Math.PI/4,Math.PI));this.twigs.push(new TWIG(this.width,this.height,this.width,this.height,-Math.PI/4,0))},createStars:function(){for(var a=0,b=this.STAR_COUNT;a<b;a++){this.stars.push(new STAR(this.width,this.height,this.contextTwigs,this))}},render:function(){requestAnimationFrame(this.render);var d=0,a=this.contextTwigs,c=this.contextFireworks;for(var b=this.fireworks.length-1;b>=0;b--){d=Math.max(d,this.fireworks[b].getOpacity())}a.clearRect(0,0,this.width,this.height);c.fillStyle=this.SKY_COLOR.replace("%luminance",5+d*15);c.fillRect(0,0,this.width,this.height);for(var b=this.fireworks.length-1;b>=0;b--){if(!this.fireworks[b].render(c)){this.fireworks.splice(b,1)}}for(var b=this.stars.length-1;b>=0;b--){this.stars[b].render(a)}for(var b=this.twigs.length-1;b>=0;b--){this.twigs[b].render(a)}for(var b=this.leaves.length-1;b>=0;b--){if(!this.leaves[b].render(a)){this.leaves.splice(b,1)}}if(--this.leafInterval==0){this.leaves.push(new LEAF(this.width,this.height,this));this.leafInterval=this.getRandomValue(this.LEAF_INTERVAL_RANGE)|0}if(--this.fireworkInterval==0){this.fireworks.push(new FIREWORK(this.width,this.height,this));this.maxFireworkInterval=this.getRandomValue(this.FIREWORK_INTERVAL_RANGE)|0;this.fireworkInterval=this.maxFireworkInterval}}};var TWIG=function(d,b,a,f,e,c){this.width=d;this.height=b;this.x=a;this.y=f;this.angle=e;this.theta=c;this.rate=Math.min(d,b)/500};TWIG.prototype={SHAKE_FREQUENCY:Math.PI/300,MAX_LEVEL:4,COLOR:"hsl(120, 60%, 1%)",renderBlock:function(c,a,g,d,f,e){c.save();c.translate(a,g);c.rotate(this.angle+e*(f+1));c.scale(this.rate,this.rate);c.beginPath();c.moveTo(0,0);c.lineTo(0,-d);c.stroke();c.fill();if(f==this.MAX_LEVEL){d=d/(1-f/10);c.save();c.beginPath();c.scale(1-f/10,1-f/10);c.moveTo(0,-d);c.quadraticCurveTo(30,-d-20,0,-d-80);c.quadraticCurveTo(-30,-d-20,0,-d);c.stroke();c.fill();c.restore();c.restore()}else{for(var b=-1;b<=1;b+=2){c.save();c.translate(0,-40);c.rotate((Math.PI/3-Math.PI/20*f)*b);c.scale(1-f/10,1-f/10);c.beginPath();c.moveTo(0,0);c.lineTo(0,-d*0.8);c.quadraticCurveTo(30,-d*0.8-20,0,-d*0.8-80);c.quadraticCurveTo(-30,-d*0.8-20,0,-d*0.8);c.stroke();c.fill();c.restore()}c.restore();f++;this.renderBlock(c,a+40*Math.sin(this.angle+e*f),g-40*Math.cos(this.angle+e*f),d,f,e)}},render:function(a){a.fillStyle=this.COLOR;a.strokeStyle=this.COLOR;a.lineWidth=3;this.renderBlock(a,this.x,this.y,40,0,Math.PI/48*Math.sin(this.theta));this.theta+=this.SHAKE_FREQUENCY;this.theta%=Math.PI*2}};var LEAF=function(b,a,c){this.width=b;this.height=a;this.renderer=c;this.init()};LEAF.prototype={OFFSET:100,VELOCITY_Y:3,COLOR:"hsl(120, 60%, 1%)",init:function(){this.x=this.renderer.getRandomValue({min:0,max:this.width});this.y=-this.OFFSET;this.vx=this.renderer.getRandomValue({min:0,max:1})*(this.x<=this.width/2?1:-1);this.vy=this.VELOCITY_Y;this.rate=this.renderer.getRandomValue({min:0.4,max:0.8});this.theta=this.renderer.getRandomValue({min:0,max:Math.PI*2});this.deltaTheta=this.renderer.getRandomValue({min:-Math.PI/300,max:Math.PI/300})},render:function(a){a.save();a.filleStyle=this.COLOR;a.translate(this.x,this.y);a.rotate(this.theta);a.scale(this.rate,this.rate);a.beginPath();a.moveTo(0,0);a.quadraticCurveTo(30,-20,0,-80);a.quadraticCurveTo(-30,-20,0,0);a.fill();a.restore();this.x+=this.vx*this.rate;this.y+=this.vy*this.rate;this.theta+=this.deltaTheta;this.theta%=Math.PI*2;return this.y<=this.height+this.OFFSET&&this.x>=-this.OFFSET&&this.x<=this.width+this.OFFSET}};var STAR=function(c,a,b,d){this.width=c;this.height=a;this.renderer=d;this.init(b)};STAR.prototype={RADIUS_RANGE:{min:1,max:4},COUNT_RANGE:{min:100,max:1000},DELTA_THETA:Math.PI/30,DELTA_PHI:Math.PI/30000,init:function(a){this.x=this.renderer.getRandomValue({min:0,max:this.width});
this.y=this.renderer.getRandomValue({min:0,max:this.height});this.radius=this.renderer.getRandomValue(this.RADIUS_RANGE);this.maxCount=this.renderer.getRandomValue(this.COUNT_RANGE)|0;this.count=this.maxCount;this.theta=0;this.phi=0;this.gradient=a.createRadialGradient(0,0,0,0,0,this.radius);this.gradient.addColorStop(0,"hsla(220, 80%, 100%, 1)");this.gradient.addColorStop(0.1,"hsla(220, 80%, 80%, 1)");this.gradient.addColorStop(0.25,"hsla(220, 80%, 50%, 1)");this.gradient.addColorStop(1,"hsla(220, 80%, 30%, 0)")},render:function(a){a.save();a.globalAlpha=Math.abs(Math.cos(this.theta));a.translate(this.width/2,this.height/2);a.rotate(this.phi);a.translate(this.x-this.width/2,this.y-this.height/2);a.beginPath();a.fillStyle=this.gradient;a.arc(0,0,this.radius,0,Math.PI*2,false);a.fill();a.restore();if(--this.count==0){this.theta=Math.PI;this.count=this.maxCount}if(this.theta>0){this.theta-=this.DELTA_THETA}this.phi+=this.DELTA_PHI;this.phi%=Math.PI/2}};var FIREWORK=function(b,a,c){this.width=b;this.height=a;this.renderer=c;this.init()};FIREWORK.prototype={COLOR:"hsl(%hue, 80%, 60%)",PARTICLE_COUNT:300,DELTA_OPACITY:0.01,RADIUS:2,VELOCITY:-3,WAIT_COUNT_RANGE:{min:30,max:60},THRESHOLD:50,DELTA_THETA:Math.PI/10,GRAVITY:0.002,init:function(){this.setParameters();this.createParticles()},setParameters:function(){var a=256*Math.random()|0;this.x=this.renderer.getRandomValue({min:this.width/8,max:this.width*7/8});this.y=this.renderer.getRandomValue({min:this.height/4,max:this.height/2});this.x0=this.x;this.y0=this.height+this.RADIUS;this.color=this.COLOR.replace("%hue",a);this.status=0;this.theta=0;this.waitCount=this.renderer.getRandomValue(this.WAIT_COUNT_RANGE);this.opacity=1;this.velocity=this.VELOCITY;this.particles=[]},createParticles:function(){for(var a=0,b=this.PARTICLE_COUNT;a<b;a++){this.particles.push(new PARTICLE(this.x,this.y,this.renderer))}},getOpacity:function(){return this.status==2?this.opacity:0},render:function(b){switch(this.status){case 0:b.save();b.fillStyle=this.color;b.globalCompositeOperation="lighter";b.globalAlpha=(this.y0-this.y)<=this.THRESHOLD?((this.y0-this.y)/this.THRESHOLD):1;b.translate(this.x0+Math.sin(this.theta)/2,this.y0);b.scale(0.8,2.4);b.beginPath();b.arc(0,0,this.RADIUS,0,Math.PI*2,false);b.fill();b.restore();this.y0+=this.velocity;if(this.y0<=this.y){this.status=1}this.theta+=this.DELTA_THETA;this.theta%=Math.PI*2;this.velocity+=this.GRAVITY;return true;case 1:if(--this.waitCount<=0){this.status=2}return true;case 2:b.save();b.globalCompositeOperation="lighter";b.globalAlpha=this.opacity;b.fillStyle=this.color;for(var a=0,c=this.particles.length;a<c;a++){this.particles[a].render(b,this.opacity)}b.restore();this.opacity-=this.DELTA_OPACITY;return this.opacity>0}}};var PARTICLE=function(a,c,b){this.x=a;this.y=c;this.renderer=b;this.init()};PARTICLE.prototype={RADIUS:1.5,VELOCITY_RANGE:{min:0,max:3},GRAVITY:0.02,FRICTION:0.98,init:function(){var c=Math.PI*2*Math.random(),b=this.renderer.getRandomValue(this.VELOCITY_RANGE),a=Math.random();this.vx=b*Math.cos(c)*a;this.vy=b*Math.sin(c)*a},render:function(b,a){b.beginPath();b.arc(this.x,this.y,this.RADIUS,0,Math.PI*2,false);b.fill();this.x+=this.vx;this.y+=this.vy;this.vy+=this.GRAVITY;this.vx*=this.FRICTION;this.vy*=this.FRICTION}};$(function(){RENDERER.init()});
	</script>

</html>