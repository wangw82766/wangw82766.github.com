<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title></title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1, user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<!--标准mui.css-->
		<link rel="stylesheet" href="css/mui.min.css">
		<link href="css/mui.picker.css" rel="stylesheet" />
		<link href="css/mui.poppicker.css" rel="stylesheet" />		
		<link rel="stylesheet" href="css/jsdApply.css" />
		<script type="text/javascript" src="js/jquery-1.9.1.min.js"></script>
		<script type="text/javascript" src="js/jsdApply.js"></script>
		<script>
        /**
         * @description 是否是微信
         */
        function IsWeChatBrower() {
            var ua = window.navigator.userAgent;
            if (ua.match(/MicroMessenger/i) == 'micromessenger') {
                return true;
            } else {
                return false;
            }
        }
        /**
         * @description 是否是ipad
         */
        function IsIPadBrower() {
            var ua = window.navigator.userAgent;
            return ua.match(/(iPad).*OS\s([\d_]+)/);
        }
        /**
         * @description 是否是iphone
         */
        function IsIPhoneBrower() {
            var ua = window.navigator.userAgent;
            return !IsIPadBrower() && ua.match(/(iPhone\sOS)\s([\d_]+)/);
        }

        /**
         * @description 是否是android
         */
        function IsAndroidBrower() {
            var ua = window.navigator.userAgent;
            return ua.match(/(Android)\s+([\d.]+)/);
        }


        function IsDefine(value) {
            if (value == null || value == "" || value == "undefined" || value == undefined || value == "null" || value == "(null)" || value == 'NULL' || typeof(value) == 'undefined') {
                return false;
            } else {
                value = value + "";
                value = value.replace(/\s/g, "");
                if (value == "") {
                    return false;
                }
                return true;
            }
        }

        function QueryString(val) {
            var uri = window.location.search;
            var re = new RegExp("" + val + "=([^&?]*)", "ig");
            return ((uri.match(re)) ? (uri.match(re)[0].substr(val.length + 1)) : null);
        }

        function IsMobile(value) {
            var myreg = /^(((13[0-9]{1})|(15[0-9]{1})|(17[0-9]{1})|(18[0-9]{1}))+\d{8})$/;
            if (!myreg.test(value)) {
                return false;
            }
            return true;
        }
    </script>
	</head>
	<body>
		<!--完善借款信息弹窗-->
		<div class="jsdpiPopA" style="display: none;">
			<div class="jsdpiPopconB" style="display: block;">
				<i></i>
				<p class="pA"><i></i>您的申请已提交<br/>稍后专业客服将与您联系</p>
				<div class="popBtn popBtnA">
					<a href="javascript:void(0)">下载无忧借款APP，了解更多</a>
				</div>
			</div>
		</div>
		<div class="jsdpiPop" style="display: none;">
			<div class="jsdpiPopconB" style="display: block;">
				<p class="pB"></p>
				<div class="popBtn popBtnB">
					<a href="javascript:void(0)">确定</a>
				</div>
			</div>
		</div>
		<header class="mui-bar mui-bar-nav headTitle">			
			<h1 class="mui-title">完善借款信息</h1>
		</header>
		<div class="mui-content PerfectInfo">
			<ul class="mui-table-view">
				<li class="mui-table-view-cell">
					<a>
						<span>姓名</span><input type="text" placeholder="请输入真实姓名" id="name"/>
					</a>
				</li>
				<li class="mui-table-view-cell">
					<a>
						<span>身份证号</span><input type="text" placeholder="请输入身份证号" id="idcard" />
					</a>
				</li>
				<li class="mui-table-view-cell">
					<a class="mui-navigate-right" id="chooseOccupation">
						<span>您的身份</span><div id="occupation" data-id="1" class="choose">上班族</div>
					</a>
				</li>
				<li class="mui-table-view-cell activeA">
					<a>
						<span>贷款金额（万元）</span><input type="text" placeholder="请输入贷款金额" id="liability_limit" />
					</a>
				</li>
				<li class="mui-table-view-cell activeA">
					<a>
						<span>贷款期限（个月）</span><input type="text" placeholder="请输入贷款期限" id="liability_limit" />
					</a>
				</li>
				
				
				
				
				<li class="mui-table-view-cell">
					<a class="mui-navigate-right" id="chooseWhether_borrowing_records">
						<span>贷款城市</span><div id="whether_borrowing_records" data-id="0" class="choose">请选择贷款城市</div>
					</a>
				</li>
				
			</ul>
			<a class="mui-btn mui-btn-primary mui-btn-block" href="javascript:void(0)" id="btnPerfectInformation">立即申请</a>				    					
		</div>
	</body>
	<script src="js/mui.min.js"></script>
	<script src="js/mui.picker.js"></script>
	<script src="js/mui.poppicker.js"></script>
	<script>
		mui.init();
        //学历枚举
        var education_enums =[{
            "id": "1",
            "text": "高中以下"
        }, {
            "id": "2",
            "text": "高中"
        }, {
            "id": "3",
            "text": "中专"
        }, {
            "id": "4",
            "text": "大专"
        }, {
            "id": "5",
            "text": "本科"
        }, {
            "id": "6",
            "text": "硕士"
        }, {
            "id": "7",
            "text": "博士"
        }];
        var loan_amount_enums = [
            '1000元',
            '2000元',
            '3000元',
            '4000元',
            '5000元',
            '6000元',
            '7000元',
            '8000元',
            '9000元',
            '10000元'
        ];
        //职业枚举
        var occupation_enums = [{
            "id": "1",
            "text": "上班族"
        }, {
            "id": "2",
            "text": "学生族"
        }, {
            "id": "6",
            "text": "企业主"
        }];
        //是否借款记录枚举
        var whether_borrowing_records_enums = [{
            "id": "0",
            "text": "无"
        }, {
            "id": "1",
            "text": "有"
        }];
		mui.ready(function() {
			//学历
			mui("body").on("tap", "#chooseEducation", function() {
				var popPicker = new mui.PopPicker();
				popPicker.setData(education_enums);
				popPicker.show(function(item) {
					$('#education').html(item[0]['text']);
					$('#education').attr('data-id',item[0]['id']);
				});
			});
			//申请额度
			mui("body").on("tap", "#chooseLoan_amount", function() {
				var popPicker = new mui.PopPicker();
				popPicker.setData(loan_amount_enums);
				popPicker.show(function(item) {
					$('#loan_amount').html(item[0]);
				});
			});
			//工作性质
			mui("body").on("tap", "#chooseOccupation", function() {
				var popPicker = new mui.PopPicker();
				popPicker.setData(occupation_enums);
				popPicker.show(function(item) {
					$('#occupation').html(item[0]['text']);
					$('#occupation').attr('data-id',item[0]['id']);
				});
			});
			//借款记录
			mui("body").on("tap", "#chooseWhether_borrowing_records", function() {
				var popPicker = new mui.PopPicker();
				popPicker.setData(whether_borrowing_records_enums);
				popPicker.show(function(item) {
					$('#whether_borrowing_records').html(item[0]['text']);
					$('#whether_borrowing_records').attr('data-id',item[0]['id']);
					if(item[0]['id']==1){
						$('.activeA').show();
					}else{
						$('.activeA').hide();
					}
				});
			});
		});	
		mui('.mui-scroll-wrapper').scroll({
			deceleration: 0.0005 ,//flick 减速系数，系数越大，滚动速度越慢，滚动距离越小，默认值0.0006
			indicators: false
		});
		function IsDefine(value) {
            if (value == null || value == "" || value == "undefined" || value == undefined || value == "null" || value == "(null)" || value == 'NULL' || typeof(value) == 'undefined') {
                return false;
            } else {
                value = value + "";
                value = value.replace(/\s/g, "");
                if (value == "") {
                    return false;
                }
                return true;
            }
        }

        function QueryString(val) {
            var uri = window.location.search;
            var re = new RegExp("" + val + "=([^&?]*)", "ig");
            return ((uri.match(re)) ? (uri.match(re)[0].substr(val.length + 1)) : null);
        }

        function IsMobile(value) {
            var myreg = /^(((13[0-9]{1})|(15[0-9]{1})|(17[0-9]{1})|(18[0-9]{1}))+\d{8})$/;
            if (!myreg.test(value)) {
                return false;
            }
            return true;
        }

        var phone_no = QueryString("phone_no");

//      if (IsDefine(phone_no) == false || IsMobile(phone_no) == false) {
//          window.location = "jsdApply.html";
//      }
        //渠道id  默认为1
        var channel_id = "1";
        var channel_id = QueryString("channel_id");
        if (IsDefine(channel_id) == false) {
            channel_id = "1";
        }
        //完善资料点击
        $("#btnPerfectInformation").bind("click", function() {
            var name = $("#name").val();
            var idcard = $("#idcard").val();
            var education = $("#education").attr('data-id');
            var loan_amount = $("#loan_amount").html().replace('元','');
            var occupation = $("#occupation").attr('data-id');
            var whether_borrowing_records = $("#whether_borrowing_records").attr('data-id');
            var borrowing_platform = $("#borrowing_platform").val();
            var liability_limit = $("#liability_limit").val();
            if (IsDefine(name) == false) {
            	$('.jsdpiPop').show();
            	$('.jsdpiPop .pB').html('请输入姓名');
                //alert("请输入姓名");
                return false;
            }
            if (IsDefine(idcard) == false) {
            	$('.jsdpiPop').show();
            	$('.jsdpiPop .pB').html('请输入身份证');
                //alert("请输入身份证");
                return false;
            }
            if (education == '') {
            	$('.jsdpiPop').show();
            	$('.jsdpiPop .pB').html('请选择学历');
                //alert("请选择学历");
                return false;
            }
            if (whether_borrowing_records == "1") {
                if (IsDefine(borrowing_platform) == false) {
                	$('.jsdpiPop').show();
            		$('.jsdpiPop .pB').html('请输入借款平台');
                    //alert("请输入借款平台");
                    return false;
                }
                if (IsDefine(liability_limit) == false) {
                	$('.jsdpiPop').show();
            		$('.jsdpiPop .pB').html('请输入负债额度');
                    //alert("请输入负债额度");
                    return false;
                } else {
                    if (parseFloat(liability_limit) < 1) {
                    	$('.jsdpiPop').show();
            			$('.jsdpiPop .pB').html('负债额度必须大于0');
                        //alert("负债额度必须大于0");
                        return false;
                    }
                }
            } else {
                borrowing_platform = "无";
                liability_limit = "0.00";
            }
            var is_test = QueryString("is_test");
            //var submit_url = "http://docking.y4qq.com/advertise/channel?channel_id=1&advertise_id=4&name=" + name + "&phone_no=" + phone_no + "&idcard=" + idcard + "&loan_amount=" + loan_amount + "&education=" + education + "&occupation=" + occupation + "&whether_borrowing_records=" + whether_borrowing_records + "&borrowing_platform=" + borrowing_platform + "&liability_limit=" + liability_limit + "&jsonp_cb_fun=perfectInformationCBFun";

            var submit_url = "http://adv.qingdianwan.com/advertise/channel?channel_id=1&advertise_id=5&name=" + name + "&phone_no=" + phone_no + "&idcard=" + idcard + "&loan_amount=" + loan_amount + "&education=" + education + "&occupation=" + occupation + "&whether_borrowing_records=" + whether_borrowing_records + "&borrowing_platform=" + borrowing_platform + "&liability_limit=" + liability_limit + "&jsonp_cb_fun=perfectInformationCBFun";
            $.ajax(submit_url, {
                "method": "GET",
                "dataType": "jsonp",
                "success": "perfectInformationCBFun"
            });
        });

        //完善资料回调
        function perfectInformationCBFun(data) {
        	if(data['code']==10000){
	            $('.jsdpiPop').hide();
	            $('.jsdpiPopA').show();
	            $('.popBtnA').click(function() {
			        if (IsAndroidBrower()) {
			            window.location = "http://pm.qingdianwan.com/apk/jiekuandashi_v1_1.apk";
			        }
			        if (IsIPadBrower() || IsIPhoneBrower()) {
			            window.location = "https://itunes.apple.com/cn/app/id1196649886?mt=8";
			        }
			    });
            	$('.jsdpiPopA i').click(function(){
            	 	window.location = "jsdApply.html";
            	});
	        }else{
	        	$('.jsdpiPop').show();
	        	$('.jsdpiPop .pA').hide();
            	$('.jsdpiPop .pB').html(data['message']);
	        }
        }
        $('.jsdpiPop .popBtnB').click(function(){
        	$(this).parent().parent().hide();
        });
	</script>
</html>
